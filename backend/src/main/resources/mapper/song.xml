<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.ssafy.kpop.dao.SongDao">
	
	<select id="newest_list" parameterType="map" resultType="SongListDto">
		select s.id, s.song_name, s.singer_name, s.singer_img, s.album_name,
		s.album_cover,s.genre, s.issue_date, ifnull(slc.song_like_cnt,0)
		from song as s left join song_like_count as slc
		on s.id = slc.song_id
		order by s.issue_date desc limit #{startList}, #{listSize};
	</select>
	
	<select id="get_song" parameterType="int" resultType="SongDto">
		select * from song where id=#{id}
	</select>
	
	<select id="get_word" parameterType="int" resultType="SongwordDto">
		select * from songword where song_id=#{id}
	</select>
	
	<select id="search_word" parameterType="String" resultType="NamuwikiDto">
		select * from namuwiki where namu_title=#{word}
	</select>
	
	<insert id="regist_word" parameterType="map">
		insert into songword values( #{id}, #{word})
	</insert>
	
	<select id="check_word" parameterType="map" resultType="SongwordDto">
		select * from songword where song_id=#{id} and namu_title = #{word}
	</select>
	
	<select id="default_list" parameterType="map" resultType="SongListDto">
		select s.id, s.song_name, s.singer_name, s.singer_img, s.album_name,
		s.album_cover,s.genre, s.issue_date, ifnull(slc.song_like_cnt,0)
		from song as s left join song_like_count as slc
		on s.id = slc.song_id
		order by slc.song_like_cnt desc, s.issue_date desc limit #{startList}, #{listSize};
	</select>
	
	<select id="search_wordlist" parameterType="SongwordDto" resultType="SongwordDto">
		select * from songword where song_id=#{song_id} and namu_title=#{namu_title}
	</select>
	
	<insert id ="insert_namu" parameterType="map">
		insert into namuwiki(uid, namu_title, namu_date) values(#{uid}, #{word}, now())
	</insert>
	
	<insert id="insert_list" parameterType="SongwordDto">
		insert into songword values(#{song_id}, #{namu_title});
	</insert>

	

</mapper>